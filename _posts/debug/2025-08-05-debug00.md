---
layout: post
title: 결국, 내 코드가 문제였고요 – 401 디버깅 후기
category: debug
tags: [debug]
comments: true
---

<!-- @format -->

이번 이슈는, 전혀 예상하지 못한 곳에서 시작됐다.<br/>
문제는 /store/regions와 같은 퍼블릭 API에서 계속해서 401 Unauthorized 에러가 발생했던 것이였다.<br/>

[공식 문서](https://medusajs.com)를 수차례 확인해봐도 해당 엔드포인트는 인증 없이 접근 가능한 것으로 명시되어 있었고,<br/>
처음엔 API 키 설정, 서버 구성, 세일즈 채널, 헤더 누락, DB초기화 등 그럴듯한 원인들을 하나씩 의심하며 점검해나갔다.<br/>

단순한 설정 문제겠지 싶어서,<br/>
미들웨어 체인도 뜯어보고, 커스텀 인증 쪽 로직도 확인해보고, 다른 퍼블릭 API도 비교해봤지만…<br/>
어딘가 이상했다. 모든 게 정상이었기때문인데.. `정상인데 안 된다,` 이게 제일 피곤한 케이스라 생각한다.<br/>

결국, 혹시나 하는 마음으로 예전에 만들어둔 커스텀 디지털 에셋 플러그인 코드를 열어봤다.<br/>
그리고 거기서 진짜 원인을 마주했다.<br/><br/>

그 플러그인 안에, /store/\* 경로에 인증 미들웨어가 덮어씌워져 있었던 거였다.<br/>
정확히 말하면, 내가 예전에 막 [메두사](https://medusajs.com/) 학습을 막 끝냈을 즈음, 생각 없이 커스텀을 시도하던 시절에 만들어둔 플러그인이었고, 그때는 그것이 전체 API 흐름에 어떤 영향을 줄지 전혀 고려하지 않았었다.<br/>

`결과적으로, 나는 내가 만든 플러그인 때문에 퍼블릭 API 요청이 인증 오류로 막히는 상황을 스스로 만들어낸 셈이였다.` <br/>

🛠 이번 문제를 해결하기까지 내가 취한 접근 방식은 다음과 같다:<br/>

### 1. 문서 재검토와 기본 설계 철학 복기

→ 메두사 공식 문서를 다시 훑으며 퍼블릭/프라이빗 API의 원칙 확인

### 2. API 인증 흐름 점검

→ 헤더, 키, 세일즈 채널 연결 여부, 인증 처리 방식 점검

### 3. 외부 의존성 제거 가정하 테스트

→ 커스텀 플러그인을 제외한 상태로 서버 실행 후 API 테스트

### 4. 플러그인 코드 내부 추적

→ /store/\* 경로에 인증 미들웨어가 등록되어 있는 부분 확인

#### 5. 플러그인 수정 및 재배포

→ 인증 설정을 제거한 뒤, 재배포 및 서버 반영 <br/>

이번 경험은 단순히 버그 하나를 잡아낸 것 이상의 의미가 있었다.<br/>
디버깅 과정에서 기본으로 돌아가 되짚어보는 습관, 그리고 내가 만든 코드라도 항상 의심해보는 자세가 얼마나 중요한지를 다시금 깨달았다.<br/><br/>

그리고 무엇보다도,<br/>
`“어쩌면 문제의 원인은 내 코드일 수도 있다”`는 생각을 너무 늦게 했다는 점에서,<br/>
배움은 늘 내 실수로부터 시작된다는 말이 떠올랐다.<br/><br/>

다음에 또 비슷한 상황이 온다면,<br/>
이번보다는 조금 더 빠르게 자기 코드부터 의심하는 개발자가 되어 있기를 바라며, 이 기록을 남긴다..
